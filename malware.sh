#!/bin/bash

if [ "$1" == "" ]
then
        echo "Wrong use"
        echo "How to use: "Command + ip minus last host" "
        echo "Example: ./findingmalware.sh 192.168.0"
        exit
else 

#sweeping hosts and searching for a SA flag

for ip in $1.{1.255}; do  
        hping3 -c 1 -S $ip -p 13 > /dev/null 2> /dev/null
        hping3 -c 1 -S $ip -p 37 > /dev/null 2> /dev/null
        hping3 -c 1 -S $ip -p 30000 > /dev/null 2> /dev/null
        hping3 -c 1 -S $ip -p 3000 > /dev/null 2> /dev/null
        hping3 -c 1 -V -S $ip -p 1337 > result.txt 

        if cat result.txt | grep "flags=SA"; 
        then
            echo "Door opened up in $ip"
            echo "$ip" > doorip.txt
            #getting HTML info
            echo "Trying to get more information"
            printf 'GET / HTTP/1.1\r\nHost: localhost\r\n\r\n' | nc $ip 1337
            exit
        else
            echo "The door in $ip didn't open"

        fi
done



fi